<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Chrome Home</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      :root {
        --bg: #f7f7f7;
        --text: #222;
        --card: #fff;
        --border: #ccc;
        --button-bg: #eaeaea;
        --button-hover: #d0d0d0;
      }
      body.dark {
        --bg: #1e1e1e;
        --text: #ddd;
        --card: #2a2a2a;
        --border: #444;
        --button-bg: #333;
        --button-hover: #444;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 1rem;
        transition: 0.3s;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      header h1 {
        font-size: 1.4rem;
        margin: 0;
      }

      header .buttons {
        display: flex;
        gap: 0.5rem;
      }

      button,
      label.button {
        cursor: pointer;
        background: var(--button-bg);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 0.4rem 0.6rem;
        border-radius: 4px;
        transition: background 0.2s;
      }

      button:hover,
      label.button:hover {
        background: var(--button-hover);
      }

      input[type="file"] {
        display: none;
      }

      .sections-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        max-width: 100%;
        gap: 0.8rem;
        align-items: start;
      }
      @media (min-width: 1800px) {
        .sections-grid {
          grid-template-columns: repeat(8, 1fr);
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 0.4rem;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.2rem;
        cursor: grab;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 0.3rem;
      }

      .bookmark {
        text-align: center;
        text-decoration: none;
        color: var(--text);
        font-size: 0.75rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.2rem;
        border-radius: 6px;
        transition: background 0.2s;
      }

      .bookmark:hover {
        background: var(--border);
      }

      .bookmark img {
        width: 24px;
        height: 24px;
        margin-bottom: 0.1rem;
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: var(--card);
        padding: 1rem;
        border-radius: 8px;
        width: 420px;
        max-width: 90%;
      }

      .modal-content input {
        width: 100%;
        margin-bottom: 0.3rem;
        padding: 0.3rem;
      }

      .toast {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        padding: 0.6rem 1rem;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      const getFavicon = (url, customIcon) => {
        if (customIcon && customIcon.trim() !== "") return customIcon.trim();
        try {
          return `https://www.google.com/s2/favicons?sz=64&domain=${new URL(url).hostname}`;
        } catch {
          return "https://www.google.com/favicon.ico";
        }
      };

      function App() {
        const [sections, setSections] = useState(
          JSON.parse(localStorage.getItem("sections") || "[]")
        );
        const [dark, setDark] = useState(localStorage.getItem("dark") === "true");
        const [dragData, setDragData] = useState(null);
        const [toast, setToast] = useState("");
        const [editSectionIndex, setEditSectionIndex] = useState(null);
        const [editSectionData, setEditSectionData] = useState(null);

        useEffect(() => {
          localStorage.setItem("sections", JSON.stringify(sections));
        }, [sections]);

        useEffect(() => {
          localStorage.setItem("dark", dark);
          document.body.classList.toggle("dark", dark);
        }, [dark]);

        const addSection = () => {
          const name = prompt("Section name:");
          if (name) setSections([...sections, { name, links: [] }]);
        };

        const onDragStart = (e, type, sectionIndex, linkIndex = null) => {
          setDragData({ type, fromSection: sectionIndex, fromIndex: linkIndex });
        };

        const onDropSection = (toIndex) => {
          if (dragData?.type !== "section") return;
          const updated = structuredClone(sections);
          const [moved] = updated.splice(dragData.fromSection, 1);
          updated.splice(toIndex, 0, moved);
          setSections(updated);
          setDragData(null);
        };

        const onDropLink = (toSection, toIndex) => {
          const { fromSection, fromIndex } = dragData;
          if (dragData?.type !== "link") return;
          const updated = structuredClone(sections);
          const [moved] = updated[fromSection].links.splice(fromIndex, 1);
          if (!updated[toSection].links) updated[toSection].links = [];
          updated[toSection].links.splice(toIndex, 0, moved);
          setSections(updated);
          setDragData(null);
        };

        const openSectionEditor = (i) => {
          setEditSectionIndex(i);
          setEditSectionData(structuredClone(sections[i]));
        };

        const saveSectionEdit = () => {
          const updated = structuredClone(sections);
          updated[editSectionIndex] = editSectionData;
          setSections(updated);
          setEditSectionIndex(null);
          setEditSectionData(null);
        };

        const exportData = () => {
          const blob = new Blob([JSON.stringify(sections, null, 2)], {
            type: "application/json",
          });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "MyHomeBookmarks.json";
          a.click();
        };

        const importData = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const data = JSON.parse(reader.result);
              if (Array.isArray(data)) {
                setSections(data);
                setToast("Imported successfully!");
              } else {
                alert("Invalid file format");
              }
            } catch {
              alert("Invalid JSON");
            }
          };
          reader.readAsText(file);
        };

        return (
          <>
            <header>
              <h1>üè† My Chrome Home</h1>
              <div className="buttons">
                <button onClick={() => setDark(!dark)}>üåì</button>
                <button onClick={addSection}>‚ûï Section</button>
                <button onClick={exportData}>‚¨áÔ∏è Export</button>
                <label className="button">
                  ‚¨ÜÔ∏è Import
                  <input type="file" accept=".json" onChange={importData} />
                </label>
              </div>
            </header>

            <div className="sections-grid">
              {sections.map((sec, i) => (
                <div
                  key={i}
                  className="card"
                  draggable
                  onDragStart={(e) => onDragStart(e, "section", i)}
                  onDragOver={(e) => e.preventDefault()}
                  onDrop={(e) => {
                    e.preventDefault();
                    if (dragData?.type === "section") onDropSection(i);
                  }}
                >
                  <div className="section-header">
                    <strong>{sec.name}</strong>
                    <div>
                      <button onClick={() => openSectionEditor(i)}>üìù</button>
                    </div>
                  </div>
                  <div className="grid">
                    {sec.links.map((l, j) => (
                      <a
                        key={j}
                        href={l.url}
                        target="_blank"
                        className="bookmark"
                        draggable
                        onDragStart={(e) => onDragStart(e, "link", i, j)}
                        onDragOver={(e) => e.preventDefault()}
                        onDrop={(e) => {
                          e.preventDefault();
                          if (dragData?.type === "link") onDropLink(i, j);
                        }}
                        title={l.url}
                      >
                        <img
                          src={getFavicon(l.url, l.icon)}
                          onError={(e) =>
                            (e.target.src = "https://www.google.com/favicon.ico")
                          }
                        />
                        <div>{l.title}</div>
                      </a>
                    ))}
                  </div>
                </div>
              ))}
            </div>

            {editSectionData && (
              <div className="modal">
                <div className="modal-content">
                  <h3>Edit Section</h3>
                  <input
                    value={editSectionData.name}
                    onChange={(e) =>
                      setEditSectionData({
                        ...editSectionData,
                        name: e.target.value,
                      })
                    }
                    placeholder="Section name"
                  />
                  {editSectionData.links.map((link, i) => (
                    <div key={i}>
                      <img
                        src={getFavicon(link.url, link.icon)}
                        onError={(e) =>
                          (e.target.src = "https://www.google.com/favicon.ico")
                        }
                        style={{
                          width: "16px",
                          height: "16px",
                          verticalAlign: "middle",
                          marginRight: "4px",
                        }}
                      />
                      <input
                        value={link.title}
                        onChange={(e) => {
                          const copy = structuredClone(editSectionData);
                          copy.links[i].title = e.target.value;
                          setEditSectionData(copy);
                        }}
                        placeholder="Title"
                      />
                      <input
                        value={link.url}
                        onChange={(e) => {
                          const copy = structuredClone(editSectionData);
                          copy.links[i].url = e.target.value;
                          setEditSectionData(copy);
                        }}
                        placeholder="URL"
                      />
                      <input
                        value={link.icon || ""}
                        onChange={(e) => {
                          const copy = structuredClone(editSectionData);
                          copy.links[i].icon = e.target.value;
                          setEditSectionData(copy);
                        }}
                        placeholder="Icon URL or emoji"
                        style={{ width: "120px" }}
                      />
                    </div>
                  ))}
                  <button
                    onClick={() => {
                      const copy = structuredClone(editSectionData);
                      copy.links.push({ title: "New", url: "", icon: "" });
                      setEditSectionData(copy);
                    }}
                  >
                    ‚ûï Add Link
                  </button>
                  <button onClick={saveSectionEdit}>üíæ Save</button>
                  <button onClick={() => setEditSectionData(null)}>‚ùå Cancel</button>
                </div>
              </div>
            )}

            {toast && (
              <div className="toast">
                {toast}
                {setTimeout(() => setToast(""), 3000)}
              </div>
            )}
          </>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
