<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Chrome Home</title>

<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 1rem;
  --bg: #f8f9fa;
  --text: #222;
  --card: #fff;
  --shadow: rgba(0,0,0,0.1);
  transition: background 0.3s, color 0.3s;
}
body.dark {
  --bg: #1e1e1e;
  --text: #eee;
  --card: #2c2c2c;
  --shadow: rgba(255,255,255,0.1);
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.6rem;
}
button {
  cursor: pointer;
  border: none;
  border-radius: 6px;
  padding: 4px 8px;
  margin: 2px;
  background: var(--card);
  box-shadow: 0 1px 2px var(--shadow);
  color: var(--text);
  transition: all .2s;
}
button:hover { transform: translateY(-1px); }

.sections-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  max-width: 100%;
  gap: 0.8rem;
  align-items: start;
}

@media (min-width: 1800px) {
  .sections-grid {
    grid-template-columns: repeat(8, 1fr); /* max 8 columns */
  }
}


.card {
  background: var(--card);
  border-radius: 10px;
  box-shadow: 0 1px 3px var(--shadow);
  padding: 0.6rem;
  height: fit-content;
  transition: transform 0.2s;
}
.card:hover { transform: translateY(-2px); }

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.3rem;
  cursor: grab;
}
.section-header h2 {
  font-size: 0.9rem;
  margin: 0;
}
.section-header:active { cursor: grabbing; }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 0.3rem;
}
.bookmark {
  text-align: center;
  background: var(--card);
  border-radius: 6px;
  padding: 0.25rem;
  transition: transform 0.15s;
  cursor: grab;
}
.bookmark:hover { transform: scale(1.05); }
.bookmark.dragging { opacity: 0.4; }
.bookmark img {
  width: 22px;
  height: 22px;
  margin-bottom: 0.1rem;
  pointer-events: none;
}
.bookmark div {
  font-size: 0.65rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.modal-bg {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal {
  background: var(--card);
  padding: 0.8rem;
  border-radius: 8px;
  box-shadow: 0 4px 10px var(--shadow);
  min-width: 260px;
}
input, select {
  width: 100%;
  padding: 6px;
  margin: 3px 0;
  border: 1px solid #aaa;
  border-radius: 4px;
  background: var(--bg);
  color: var(--text);
  font-size: 0.85rem;
}
.toast {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: var(--card);
  color: var(--text);
  padding: 6px 10px;
  border-radius: 6px;
  box-shadow: 0 2px 4px var(--shadow);
  opacity: 0;
  transition: opacity .3s;
}
.toast.show { opacity: 1; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

function App() {
  const [sections, setSections] = useState(() =>
    JSON.parse(localStorage.getItem("sections")) || [{ name: "Favorites", links: [] }]
  );
  const [showModal, setShowModal] = useState(false);
  const [newLink, setNewLink] = useState({ url: "", title: "", section: 0 });
  const [editSectionIndex, setEditSectionIndex] = useState(null);
  const [editSectionData, setEditSectionData] = useState(null);
  const [dark, setDark] = useState(localStorage.getItem("darkMode") === "true");
  const [dragData, setDragData] = useState(null);
  const [toast, setToast] = useState("");

  useEffect(() => {
    localStorage.setItem("sections", JSON.stringify(sections));
  }, [sections]);

  useEffect(() => {
    document.body.classList.toggle("dark", dark);
    localStorage.setItem("darkMode", dark);
  }, [dark]);

  const showToast = (msg) => {
    setToast(msg);
    setTimeout(() => setToast(""), 2500);
  };

  const getFavicon = (url) => {
    try { const u = new URL(url); return `${u.origin}/favicon.ico`; }
    catch { return "https://www.google.com/s2/favicons?domain="+url; }
  };

  const addSection = () => {
    const name = prompt("Section name:");
    if (name) setSections([...sections, { name, links: [] }]);
  };

  const addLink = () => {
    if (!newLink.url || !newLink.title) return;
    const updated = structuredClone(sections);
    updated[newLink.section].links.push({ url: newLink.url, title: newLink.title });
    setSections(updated);
    setShowModal(false);
    setNewLink({ url: "", title: "", section: 0 });
  };

  const exportData = (auto = false) => {
    const dateStr = new Date().toISOString().split("T")[0].replace(/-/g, "");
    const filename = auto ? `ChromeHomeBackup-${dateStr}.json` : "MyHomeBookmarks.json";
    const dataStr = JSON.stringify(sections, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    localStorage.setItem("lastBackup", new Date().toISOString());
    if (auto) showToast("‚úÖ Auto backup created");
  };

  const importData = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const imported = JSON.parse(ev.target.result);
        if (!Array.isArray(imported)) throw new Error("Invalid format");
        const replace = confirm("OK = Replace, Cancel = Merge");
        setSections(replace ? imported : [...sections, ...imported]);
        showToast("‚úÖ Import successful");
      } catch (err) {
        alert("Import failed: " + err.message);
      }
    };
    reader.readAsText(file);
  };

  const onDragStart = (e, type, fromSection, fromIndex) => {
    e.dataTransfer.effectAllowed = "move";
    setDragData({ type, fromSection, fromIndex });
  };

  const onDropSection = (toIndex) => {
    if (!dragData || dragData.type !== "section" || dragData.fromIndex === toIndex) return;
    const updated = structuredClone(sections);
    const [moved] = updated.splice(dragData.fromIndex, 1);
    updated.splice(toIndex, 0, moved);
    setSections(updated);
    setDragData(null);
  };

  const onDropLink = (toSection, toIndex) => {
    if (!dragData || dragData.type !== "link") return;
    const { fromSection, fromIndex } = dragData;
    const updated = structuredClone(sections);
    const [moved] = updated[fromSection].links.splice(fromIndex, 1);
    const insertIndex = Number.isInteger(toIndex) ? toIndex : updated[toSection].links.length;
    updated[toSection].links.splice(insertIndex, 0, moved);
    setSections(updated);
    setDragData(null);
  };

  const openSectionEditor = (index) => {
    setEditSectionIndex(index);
    setEditSectionData(JSON.parse(JSON.stringify(sections[index])));
  };

  const saveSectionEdit = () => {
    if (!editSectionData) return;
    const updated = [...sections];
    updated[editSectionIndex] = editSectionData;
    setSections(updated);
    setEditSectionIndex(null);
    setEditSectionData(null);
    showToast("‚úÖ Section updated");
  };

  const removeLinkFromEditor = (linkIndex) => {
    const newData = {...editSectionData};
    newData.links.splice(linkIndex, 1);
    setEditSectionData(newData);
  };

  return (
    <div>
      <header>
        <h1 style={{fontSize:'1rem'}}>üè† My Chrome Home</h1>
        <div>
          <button onClick={() => setDark(!dark)}>üåì</button>
          <button onClick={addSection}>ÔºãSec</button>
          <button onClick={() => setShowModal(true)}>ÔºãURL</button>
          <button onClick={() => exportData(false)}>‚¨á Export</button>
          <label style={{ cursor: "pointer" }}>
            ‚¨Ü Import
            <input type="file" accept=".json" onChange={importData} style={{ display: "none" }} />
          </label>
        </div>
      </header>

      <div className="sections-grid">
        {sections.map((sec, i) => (
          <div key={i}
            className="card"
            onDragOver={(e) => e.preventDefault()}
            onDrop={(e) => { e.preventDefault(); if (dragData?.type === "link") onDropLink(i); }}>
            <div className="section-header"
                 draggable
                 onDragStart={(e) => onDragStart(e, "section", null, i)}
                 onDrop={(e) => { e.preventDefault(); if (dragData?.type === "section") onDropSection(i); }}>
              <h2
                contentEditable
                suppressContentEditableWarning
                onBlur={(e) => {
                  const updated = structuredClone(sections);
                  updated[i].name = e.target.textContent.trim();
                  setSections(updated);
                }}>{sec.name}</h2>
              <button onClick={() => openSectionEditor(i)}>üìù</button>
            </div>
            <div className="grid"
              onDragOver={(e) => e.preventDefault()}
              onDrop={(e) => { e.preventDefault(); if (dragData?.type === "link") onDropLink(i); }}>
              {sec.links.map((l, j) => (
                <a key={j}
				   href={l.url}
				   target="_blank"
				   className={`bookmark ${dragData?.fromIndex===j && dragData?.fromSection===i ? "dragging":""}`}
				   draggable
				   onDragStart={(e) => onDragStart(e, "link", i, j)}
				   onDragOver={(e) => e.preventDefault()}
				   onDrop={(e) => { e.preventDefault(); if (dragData?.type === "link") onDropLink(i, j); }}
				   title={l.url}>
				  <img src={getFavicon(l.url)} onError={(e) => e.target.src='https://www.google.com/favicon.ico'}/>
				  <div>{l.title}</div>
				</a>
              ))}
            </div>
          </div>
        ))}
      </div>

      {/* Add URL Modal */}
      {showModal && (
        <div className="modal-bg" onClick={() => setShowModal(false)}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <h3 style={{marginTop:0,fontSize:'0.9rem'}}>Add URL</h3>
            <input type="text" placeholder="Title"
              value={newLink.title}
              onChange={(e) => setNewLink({...newLink, title: e.target.value})}/>
            <input type="url" placeholder="https://example.com"
              value={newLink.url}
              onChange={(e) => setNewLink({...newLink, url: e.target.value})}/>
            <select value={newLink.section}
              onChange={(e) => setNewLink({...newLink, section:+e.target.value})}>
              {sections.map((s,i)=><option key={i} value={i}>{s.name}</option>)}
            </select>
            <div style={{ textAlign: "right", marginTop: "0.4rem" }}>
              <button onClick={addLink}>Add</button>
            </div>
          </div>
        </div>
      )}

      {/* Section Editor Modal */}
      {editSectionData && (
        <div className="modal-bg" onClick={() => {setEditSectionData(null);setEditSectionIndex(null);}}>
          <div className="modal" style={{maxWidth:'480px'}} onClick={(e) => e.stopPropagation()}>
            <h3>Edit Section</h3>
            <input
              type="text"
              value={editSectionData.name}
              onChange={(e) => setEditSectionData({...editSectionData, name: e.target.value})}
              placeholder="Section Name"
            />
            <h4 style={{marginBottom:'4px'}}>Links</h4>
            {editSectionData.links.map((link, idx) => (
              <div key={idx} style={{display:'flex', gap:'4px', marginBottom:'4px'}}>
                <input
                  type="text"
                  value={link.title}
                  onChange={(e) => {
                    const newData = {...editSectionData};
                    newData.links[idx].title = e.target.value;
                    setEditSectionData(newData);
                  }}
                  placeholder="Title"
                  style={{flex:'1'}}
                />
                <input
                  type="url"
                  value={link.url}
                  onChange={(e) => {
                    const newData = {...editSectionData};
                    newData.links[idx].url = e.target.value;
                    setEditSectionData(newData);
                  }}
                  placeholder="https://..."
                  style={{flex:'2'}}
                />
                <button onClick={() => removeLinkFromEditor(idx)}>‚ùå</button>
              </div>
            ))}
            <button
              onClick={() => {
                const newData = {...editSectionData};
                newData.links.push({ title: "New Link", url: "https://" });
                setEditSectionData(newData);
              }}
            >ÔºãAdd Link</button>
            <div style={{textAlign:'right', marginTop:'6px'}}>
              <button onClick={saveSectionEdit}>üíæ Save</button>
            </div>
          </div>
        </div>
      )}

      {toast && <div className="toast show">{toast}</div>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>

</body>
</html>
